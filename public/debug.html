<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Livewire Production - TimeKeeper</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ðŸ”§ Debug Livewire Production - TimeKeeper</h1>
    
    <div class="debug-section">
        <h2>1. Environment Check</h2>
        <div id="env-check">
            <p><strong>Current URL:</strong> <span id="current-url"></span></p>
            <p><strong>User Agent:</strong> <span id="user-agent"></span></p>
            <p><strong>Protocol:</strong> <span id="protocol"></span></p>
        </div>
    </div>

    <div class="debug-section">
        <h2>2. CSRF Token Check</h2>
        <div id="csrf-check">
            <p><strong>CSRF Meta Tag:</strong> <span id="csrf-meta"></span></p>
            <p><strong>CSRF Token Value:</strong> <span id="csrf-value"></span></p>
        </div>
    </div>

    <div class="debug-section">
        <h2>3. Livewire Scripts Check</h2>
        <div id="livewire-check">
            <p><strong>Livewire Object:</strong> <span id="livewire-object"></span></p>
            <p><strong>Livewire Version:</strong> <span id="livewire-version"></span></p>
            <p><strong>Alpine.js:</strong> <span id="alpine-check"></span></p>
        </div>
    </div>

    <div class="debug-section">
        <h2>4. Network & Assets Check</h2>
        <div id="network-check">
            <p><strong>Vite Assets:</strong> <span id="vite-assets"></span></p>
            <p><strong>Build Manifest:</strong> <span id="build-manifest"></span></p>
        </div>
    </div>

    <div class="debug-section">
        <h2>5. Form Submission Test</h2>
        <form id="test-form" method="POST" action="/debug-form-test">
            <input type="hidden" name="_token" id="csrf-token-input">
            <input type="email" name="email" placeholder="test@example.com" required>
            <input type="password" name="password" placeholder="password" required>
            <button type="submit">Test Form Submission</button>
        </form>
        <div id="form-result"></div>
    </div>

    <div class="debug-section">
        <h2>6. Console Logs</h2>
        <pre id="console-logs"></pre>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <script>
        // Capture console logs
        let logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            logs.push({type: 'log', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleLogs();
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            logs.push({type: 'error', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleLogs();
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            logs.push({type: 'warn', message: args.join(' '), time: new Date().toLocaleTimeString()});
            updateConsoleLogs();
            originalWarn.apply(console, args);
        };

        function updateConsoleLogs() {
            const logsElement = document.getElementById('console-logs');
            logsElement.innerHTML = logs.map(log => 
                `[${log.time}] ${log.type.toUpperCase()}: ${log.message}`
            ).join('\n');
        }

        function clearLogs() {
            logs = [];
            updateConsoleLogs();
        }

        // Run diagnostics
        function runDiagnostics() {
            // Environment check
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('user-agent').textContent = navigator.userAgent;
            document.getElementById('protocol').textContent = window.location.protocol;

            // CSRF check
            const csrfMeta = document.querySelector('meta[name="csrf-token"]');
            if (csrfMeta) {
                document.getElementById('csrf-meta').innerHTML = '<span class="success">âœ“ Found</span>';
                document.getElementById('csrf-value').textContent = csrfMeta.content;
                document.getElementById('csrf-token-input').value = csrfMeta.content;
            } else {
                document.getElementById('csrf-meta').innerHTML = '<span class="error">âœ— Not Found</span>';
                document.getElementById('csrf-value').innerHTML = '<span class="error">Missing</span>';
            }

            // Livewire check
            if (typeof window.Livewire !== 'undefined') {
                document.getElementById('livewire-object').innerHTML = '<span class="success">âœ“ Available</span>';
                try {
                    document.getElementById('livewire-version').textContent = window.Livewire.version || 'Unknown';
                } catch (e) {
                    document.getElementById('livewire-version').innerHTML = '<span class="warning">Available but version unknown</span>';
                }
            } else {
                document.getElementById('livewire-object').innerHTML = '<span class="error">âœ— Not Available</span>';
                document.getElementById('livewire-version').innerHTML = '<span class="error">N/A</span>';
            }

            // Alpine.js check
            if (typeof window.Alpine !== 'undefined') {
                document.getElementById('alpine-check').innerHTML = '<span class="success">âœ“ Available</span>';
            } else {
                document.getElementById('alpine-check').innerHTML = '<span class="error">âœ— Not Available</span>';
            }

            // Check for build assets
            const scripts = document.querySelectorAll('script[src]');
            const links = document.querySelectorAll('link[href]');
            let viteFound = false;
            let buildFound = false;

            scripts.forEach(script => {
                if (script.src.includes('vite') || script.src.includes('@vite')) {
                    viteFound = true;
                }
                if (script.src.includes('/build/')) {
                    buildFound = true;
                }
            });

            links.forEach(link => {
                if (link.href.includes('/build/')) {
                    buildFound = true;
                }
            });

            if (viteFound || buildFound) {
                document.getElementById('vite-assets').innerHTML = '<span class="success">âœ“ Found</span>';
            } else {
                document.getElementById('vite-assets').innerHTML = '<span class="error">âœ— Not Found</span>';
            }

            // Check build manifest
            fetch('/build/manifest.json')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('build-manifest').innerHTML = '<span class="success">âœ“ Available</span>';
                    console.log('Build manifest:', data);
                })
                .catch(error => {
                    document.getElementById('build-manifest').innerHTML = '<span class="error">âœ— Not Available</span>';
                    console.error('Build manifest error:', error);
                });
        }

        // Form submission test
        document.getElementById('test-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const resultDiv = document.getElementById('form-result');
            
            resultDiv.innerHTML = '<p class="info">Testing form submission...</p>';
            
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.content || ''
                }
            })
            .then(response => {
                if (response.ok) {
                    resultDiv.innerHTML = '<p class="success">âœ“ Form submission successful (POST method working)</p>';
                } else {
                    resultDiv.innerHTML = `<p class="error">âœ— Form submission failed: ${response.status} ${response.statusText}</p>`;
                }
                console.log('Form test response:', response);
            })
            .catch(error => {
                resultDiv.innerHTML = `<p class="error">âœ— Form submission error: ${error.message}</p>`;
                console.error('Form test error:', error);
            });
        });

        // Run diagnostics when page loads
        document.addEventListener('DOMContentLoaded', runDiagnostics);

        // Also run after a short delay to catch dynamically loaded scripts
        setTimeout(runDiagnostics, 2000);
    </script>
</body>
</html>